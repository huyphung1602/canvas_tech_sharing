<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Dive into Canvas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    width: {
                        'canvas-w': '300px'
                    },
                    height: {
                        'canvas-h': '200px'
                    }
                }
            }
        }
    </script>
    <style type="text/css">
        /* Custom styles for code blocks and canvas */
        pre {
            white-space: pre-wrap !important;
            word-wrap: break-word !important;
        }
        .canvas-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        .canvas-example {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin: 2rem 0;
        }
        .canvas-example canvas {
            background: white;
            border: 2px solid #246;
            border-radius: 0.25rem;
            margin: 1rem 0;
        }
        .example-steps {
            counter-reset: step;
            list-style-type: none;
        }
        .example-steps li {
            position: relative;
            padding-left: 2.5rem;
            margin-bottom: 1rem;
        }
        .example-steps li::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            left: 0;
            top: 0;
            width: 1.8rem;
            height: 1.8rem;
            background: #246;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }
        .mermaid {
            @apply bg-white p-4 rounded-lg my-8;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css">
</head>
<body class="bg-gray-50 text-gray-800">
    <header class="bg-blue-800 text-white py-16 mb-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-4xl font-bold mb-4">Deep Dive into Canvas</h1>
            <p class="text-xl">A comprehensive guide to Canvas rendering, optimization, and advanced techniques</p>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- 1. Canvas Fundamentals -->
        <section id="fundamentals" class="bg-white rounded-lg shadow-sm p-8 mb-16">
            <h2 class="text-3xl font-bold text-blue-800 border-b-2 border-blue-800 pb-2 mb-6">1. Canvas Fundamentals</h2>

            <div class="bg-gray-100 p-6 rounded-lg border-l-4 border-blue-800 mb-6">
                <h3 class="text-xl font-semibold text-blue-800 mb-2">What is Canvas?</h3>
                <p>The HTML Canvas API provides a means for drawing graphics via JavaScript. It's a low-level, procedural model that updates pixel by pixel.</p>
            </div>

            <h3 class="text-2xl font-semibold text-blue-800 mb-4">Key Concepts</h3>
            <div class="canvas-container">
                <div>
                    <h4>Canvas Element</h4>
                    <pre><code class="language-html">&lt;canvas width="300" height="200"&gt;&lt;/canvas&gt;</code></pre>
                    <ul>
                        <li>Resolution-dependent</li>
                        <li>Requires width and height</li>
                        <li>Fallback content support</li>
                    </ul>
                </div>
                <div>
                    <h4>Rendering Context</h4>
                    <pre><code class="language-javascript">const ctx = canvas.getContext('2d');</code></pre>
                    <ul>
                        <li>Drawing interface</li>
                        <li>State-based API</li>
                        <li>Immediate mode rendering</li>
                    </ul>
                </div>
            </div>

            <h3 class="text-2xl font-semibold text-blue-800 mb-4">Basic Drawing Operations</h3>
            <div class="canvas-example">
                <canvas id="canvas-basic" class="w-canvas-w h-canvas-h" width="300" height="200"></canvas>
                <div class="flex gap-2 mt-4">
                    <button onclick="runBasicExample()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 active:bg-blue-800">Draw Shapes</button>
                    <button onclick="stopBasicExample()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 active:bg-gray-800">Clear</button>
                </div>
            </div>
            <pre><code class="language-javascript">// Basic shapes
ctx.fillStyle = 'blue';
ctx.fillRect(x, y, width, height);    // Rectangle

ctx.beginPath();                      // Start path
ctx.arc(x, y, radius, 0, Math.PI*2);  // Circle
ctx.fill();                          // Fill shape

ctx.beginPath();                      // Triangle
ctx.moveTo(x1, y1);
ctx.lineTo(x2, y2);
ctx.lineTo(x3, y3);
ctx.closePath();
ctx.fill();</code></pre>
        </section>

        <!-- 2. Canvas Pipeline -->
        <section id="pipeline" class="bg-white rounded-lg shadow-sm p-8 mb-16">
            <h2 class="text-3xl font-bold text-blue-800 border-b-2 border-blue-800 pb-2 mb-6">2. Canvas Rendering Pipeline</h2>

            <div class="bg-gray-100 p-6 rounded-lg border-l-4 border-blue-800 mb-6">
                <h3 class="text-xl font-semibold text-blue-800 mb-2">How Canvas Works</h3>
                <p>Canvas uses an immediate mode rendering pipeline where drawing commands are executed sequentially and directly affect the pixel buffer.</p>
            </div>

            <div class="mermaid">
                graph TD
                    A[JavaScript Code] -->|Draw Commands| B[Command Queue]
                    B -->|Execution| C[Canvas Context]
                    C -->|Rasterization| D[Backing Store]
                    D -->|Composition| E[Display Buffer]
                    E -->|VSync| F[Screen]
                    style A fill:#246,color:#fff
                    style F fill:#48c,color:#fff
            </div>

            <h3 class="text-2xl font-semibold text-blue-800 mb-4">Pipeline Stages</h3>
            <ol class="example-steps">
                <li><strong>Command Queue:</strong> JavaScript drawing commands are collected</li>
                <li><strong>Context Processing:</strong> Commands are processed by the 2D context</li>
                <li><strong>Rasterization:</strong> Vector operations are converted to pixels</li>
                <li><strong>Backing Store:</strong> Pixels are stored in memory</li>
                <li><strong>Composition:</strong> Final image is composed with other elements</li>
                <li><strong>Display:</strong> Image is shown on screen</li>
            </ol>
        </section>

        <!-- 3. Canvas vs DOM -->
        <section id="comparison" class="bg-white rounded-lg shadow-sm p-8 mb-16">
            <h2 class="text-3xl font-bold text-blue-800 border-b-2 border-blue-800 pb-2 mb-6">3. Canvas vs DOM Comparison</h2>

            <div class="bg-gray-100 p-6 rounded-lg border-l-4 border-blue-800 mb-6">
                <h3 class="text-xl font-semibold text-blue-800 mb-2">When to Use Canvas vs DOM?</h3>
                <p>Choose Canvas for complex graphics and animations, DOM for interactive UI elements and simple animations.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-blue-800 mb-4">Canvas</h3>
                    <ul class="space-y-3">
                        <li class="flex items-center text-green-700">
                            <span class="mr-2">✅</span>
                            <span>High performance for complex graphics</span>
                        </li>
                        <li class="flex items-center text-green-700">
                            <span class="mr-2">✅</span>
                            <span>Better memory management</span>
                        </li>
                        <li class="flex items-center text-green-700">
                            <span class="mr-2">✅</span>
                            <span>Pixel-level control</span>
                        </li>
                        <li class="flex items-center text-red-600">
                            <span class="mr-2">❌</span>
                            <span>No built-in event handling</span>
                        </li>
                        <li class="flex items-center text-red-600">
                            <span class="mr-2">❌</span>
                            <span>Manual rendering required</span>
                        </li>
                    </ul>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-blue-800 mb-4">DOM</h3>
                    <ul class="space-y-3">
                        <li class="flex items-center text-green-700">
                            <span class="mr-2">✅</span>
                            <span>Built-in event handling</span>
                        </li>
                        <li class="flex items-center text-green-700">
                            <span class="mr-2">✅</span>
                            <span>Automatic layout</span>
                        </li>
                        <li class="flex items-center text-green-700">
                            <span class="mr-2">✅</span>
                            <span>Better accessibility</span>
                        </li>
                        <li class="flex items-center text-red-600">
                            <span class="mr-2">❌</span>
                            <span>Performance issues with many elements</span>
                        </li>
                        <li class="flex items-center text-red-600">
                            <span class="mr-2">❌</span>
                            <span>Limited visual effects</span>
                        </li>
                    </ul>
                </div>
            </div>

            <h3 class="text-2xl font-semibold text-blue-800 mb-4">Side-by-Side Animation Example</h3>
            <div class="canvas-example">
                <div class="relative h-[100px]">
                    <canvas id="canvas1" class="w-[150px]" width="150" height="100"></canvas>
                    <div id="box1" class="w-5 h-5 bg-red-500 absolute top-10"></div>
                </div>
                <div class="flex gap-2 mt-4">
                    <button onclick="runExample1()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 active:bg-blue-800">Compare Animations</button>
                    <button onclick="stopExample1()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 active:bg-gray-800">Stop</button>
                </div>
            </div>
        </section>

        <!-- 4. Basic Animations -->
        <section id="basic-animations" class="bg-white rounded-lg shadow-sm p-8 mb-16">
            <h2 class="text-3xl font-bold text-blue-800 border-b-2 border-blue-800 pb-2 mb-6">4. Basic Animations</h2>

            <div class="bg-gray-100 p-6 rounded-lg border-l-4 border-blue-800 mb-6">
                <h3 class="text-xl font-semibold text-blue-800 mb-2">Animation Principles</h3>
                <p>Canvas animations work by repeatedly clearing and redrawing the canvas with updated positions or states.</p>
            </div>

            <h3 class="text-2xl font-semibold text-blue-800 mb-4">Simple Motion Animation</h3>
            <div class="canvas-example">
                <canvas id="canvas-motion" class="w-canvas-w h-canvas-h" width="300" height="200"></canvas>
                <div class="flex gap-2 mt-4">
                    <button onclick="runMotionExample()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 active:bg-blue-800">Run Motion</button>
                    <button onclick="stopMotionExample()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 active:bg-gray-800">Stop</button>
                </div>
            </div>
            <pre><code class="language-javascript">function animate() {
    // Clear previous frame
    ctx.clearRect(0, 0, width, height);

    // Update position
    x += speed;

    // Draw at new position
    ctx.fillRect(x, y, width, height);

    // Request next frame
    requestAnimationFrame(animate);
}</code></pre>
        </section>

        <!-- 5. Time-based Animations -->
        <section id="time-based" class="bg-white rounded-lg shadow-sm p-8 mb-16">
            <h2 class="text-3xl font-bold text-blue-800 border-b-2 border-blue-800 pb-2 mb-6">5. Time-based Animations</h2>

            <div class="bg-gray-100 p-6 rounded-lg border-l-4 border-blue-800 mb-6">
                <h3 class="text-xl font-semibold text-blue-800 mb-2">Frame-based vs Time-based</h3>
                <p>Time-based animations ensure consistent speed regardless of frame rate, while frame-based animations can vary with device performance.</p>
            </div>

            <div class="mermaid">
                graph TD
                    A[requestAnimationFrame] -->|timestamp| B[Calculate Delta Time]
                    B -->|elapsed > interval| C{Update Required?}
                    C -->|Yes| D[Update Animation]
                    C -->|No| E[Skip Frame]
                    D --> F[Draw Frame]
                    E --> F
                    F --> A
            </div>

            <h3 class="text-2xl font-semibold text-blue-800 mb-4">Comparison Example</h3>
            <div class="canvas-container">
                <div>
                    <h4 class="text-lg font-semibold mb-4">Frame-based (Bad)</h4>
                    <canvas id="frame-based-canvas" class="w-full" width="300" height="100"></canvas>
                    <div class="flex gap-2 mt-4">
                        <button onclick="runFrameBasedExample()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 active:bg-blue-800">Run</button>
                        <button onclick="stopFrameBasedExample()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 active:bg-gray-800">Stop</button>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Time-based (Good)</h4>
                    <canvas id="time-based-canvas" class="w-full" width="300" height="100"></canvas>
                    <div class="flex gap-2 mt-4">
                        <button onclick="runTimeBasedExample()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 active:bg-blue-800">Run</button>
                        <button onclick="stopTimeBasedExample()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 active:bg-gray-800">Stop</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. Performance Optimization -->
        <section id="performance" class="bg-white rounded-lg shadow-sm p-8 mb-16">
            <h2 class="text-3xl font-bold text-blue-800 border-b-2 border-blue-800 pb-2 mb-6">6. Performance Optimization</h2>

            <div class="bg-gray-100 p-6 rounded-lg border-l-4 border-blue-800 mb-6">
                <h3 class="text-xl font-semibold text-blue-800 mb-2">Common Performance Issues</h3>
                <p>Canvas performance is mainly affected by the number of draw calls, canvas size, and unnecessary state changes.</p>
            </div>

            <h3 class="text-2xl font-semibold text-blue-800 mb-4">Bad vs Good Practices</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-red-600 mb-4">❌ Bad Practice</h4>
                    <pre class="bg-gray-900 rounded-lg p-6 whitespace-pre-wrap break-words"><code class="language-javascript">// Multiple state changes
shapes.forEach(shape => {
    ctx.fillStyle = shape.color;
    ctx.beginPath();
    ctx.arc(shape.x, shape.y, 5, 0, Math.PI * 2);
    ctx.fill();
});</code></pre>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-green-600 mb-4">✅ Good Practice</h4>
                    <pre class="bg-gray-900 rounded-lg p-6 whitespace-pre-wrap break-words"><code class="language-javascript">// Group by color
const byColor = shapes.reduce((acc, shape) => {
    (acc[shape.color] = acc[shape.color] || [])
        .push(shape);
    return acc;
}, {});

// Draw shapes grouped by color
Object.entries(byColor)
    .forEach(([color, shapes]) => {
        ctx.fillStyle = color;
        ctx.beginPath();
        shapes.forEach(shape => {
            ctx.arc(shape.x, shape.y,
                   5, 0, Math.PI * 2);
        });
        ctx.fill();
    });</code></pre>
                </div>
            </div>

            <h3 class="text-2xl font-semibold text-blue-800 mb-4">Performance Example</h3>
            <div class="canvas-container">
                <div>
                    <h4 class="text-lg font-semibold mb-4">Unoptimized (1000 particles)</h4>
                    <canvas id="unoptimized" class="w-canvas-w h-canvas-h" width="300" height="200"></canvas>
                    <div class="flex gap-2 mt-4">
                        <button onclick="runUnoptimizedExample()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 active:bg-blue-800">Run</button>
                        <button onclick="stopUnoptimizedExample()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 active:bg-gray-800">Stop</button>
                    </div>
                    <div id="unoptimized-fps" class="mt-2 text-sm font-mono"></div>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Optimized (1000 particles)</h4>
                    <canvas id="optimized" class="w-canvas-w h-canvas-h" width="300" height="200"></canvas>
                    <div class="flex gap-2 mt-4">
                        <button onclick="runOptimizedExample()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 active:bg-blue-800">Run</button>
                        <button onclick="stopOptimizedExample()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 active:bg-gray-800">Stop</button>
                    </div>
                    <div id="optimized-fps" class="mt-2 text-sm font-mono"></div>
                </div>
            </div>

            <h3 class="text-2xl font-semibold text-blue-800 mb-4">Optimization Techniques</h3>
            <ol class="example-steps">
                <li><strong>Batch Similar Operations:</strong> Group shapes by color/style</li>
                <li><strong>Minimize State Changes:</strong> Cache and reuse styles</li>
                <li><strong>Use Multiple Layers:</strong> Separate static and dynamic content</li>
                <li><strong>Optimize Canvas Size:</strong> Match display size</li>
                <li><strong>Object Pooling:</strong> Reuse objects instead of creating new ones</li>
                <li><strong>Off-screen Rendering:</strong> Use buffer canvas for complex scenes</li>
            </ol>
        </section>
    </div>

    <script src="script.js"></script>
</body>
</html>